<template>
  <table>
    <thead>
      <tr>
        <th>move</th>
        <th>learned</th>
        <th>details</th>
      </tr>
    </thead>
    <tbody>
      <move-row v-for='move in validMoves' v-bind:move='move'></move-row>
    </tbody>
  </table>
</template>

<script>
import MoveRow from './MoveRow.vue';

const METHOD_ORDER = ['level-up', 'machine', 'tutor', 'egg'];

const strcmp = (a, b) => {
  if (a < b) {
    return -1;
  } else if (a > b) {
    return 1;
  } else {
    return 0;
  }
};

const movecmp = (a, b) => {
  return strcmp(a.name, b.name);
};

const methodcmp = (a, b) => {
  return (METHOD_ORDER.indexOf(a.name) - METHOD_ORDER.indexOf(b.name)) || a.level - b.level;
};

export default {
  name: 'move-table',
  props: ['moves'],
  computed: {
    validMoves() {
      const items = [];
      for (const moveInfo of this.moves) {
        // console.log(moveInfo);
        const moveName = moveInfo.move.name;
        const methods = [];
        for (const details of moveInfo.version_group_details) {
          if (details.version_group.name === 'omega-ruby-alpha-sapphire') {
            const methodName = details.move_learn_method.name;
            const level = details.level_learned_at;
            const description = level ? `level ${level}` : methodName;
            methods.push({ name: methodName, level, description });
          }
        }
        methods.sort(methodcmp);
        if (methods.length) {
          items.push({ name: moveName, description: methods.map(m => m.description).join(', ') });
        }
      }
      window.items = items;
      return items.sort(movecmp);
    },
  },
  components: { MoveRow },
};
</script>